<p>
  <b>Name:</b>
  <%= @message.name %>
</p>

<p>
  <b>Gender:</b>
  <%= Message::USER_GENDER.try(:[], @message.gender) %>
</p>

<p>
  <b>Phone number:</b>
  <%= @message.phone_number %>
</p>

<p>
  <b>Qq number:</b>
  <%= @message.qq_number %>
</p>

<p>
  <b>Title:</b>
  <%= @message.title %>
</p>

<p>
  <b>Content:</b>
  <%= @message.content %>
</p>

<p>
  <b>Visible to:</b><br />
  <% if %w(admin moderator).include? current_user.role %>
    <% if @message.visible_to.empty? %>
    	All
    <% else %>
      <% @message.visible_to.each do |v| %>
    		<% user = User.find(v.flagger_id) %>
  			[<%= user.role %>] <%= user.username %> &lt;<%= user.email %>&gt;<br />
      <% end %>
    <% end %>  
  <% else %>
    <% if @message.visible_to.count == 0 %>
      All
    <% else %>
      <% if current_user.present? and current_user.role == "user" %>
        <% if @message.visible_to.count == 1 %>
          Only you
        <% else %>
          You and <%= @message.visible_to.count - 1 %> others
        <% end %>
      <% else %>
        <%= pluralize(@message.visible_to.count, "user") %>
      <% end %>
    <% end%>
  <% end %>
</p>

<% if %w(admin moderator).include? current_user.role %>
  <%= link_to 'Edit', edit_message_path(@message) %> |
<% end %>
<%= link_to 'Back', messages_path %>
